<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Admin Dashboard</title>
    <link rel="stylesheet" href="/static/css/style.css">
    <!-- Add Bootstrap CSS -->
    <link href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
    {% extends 'base.html' %}
    {% block title %}Admin Dashboard{% endblock %}
    {% block content %}
    <div class="container mt-4">
        <h2 class="mb-4">Admin Dashboard</h2>
        <div class="row mb-4">
          <div class="col-md-4">
            <div class="card text-bg-primary mb-3">
              <div class="card-body">
                <h5 class="card-title">Total Students</h5>
                <p class="card-text display-6">{{ student_count }}</p>
              </div>
            </div>
          </div>
          <div class="col-md-4">
            <div class="card text-bg-success mb-3">
              <div class="card-body">
                <h5 class="card-title">Students Submitted</h5>
                <p class="card-text display-6">{{ submitted_count }}</p>
              </div>
            </div>
          </div>
        </div>
        <h4>Exam Questions</h4>
        <table class="table table-bordered table-hover">
          <thead class="table-light">
            <tr>
              <th>ID</th>
              <th>Question</th>
              <th>Answers</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody>
            {% for q in questions %}
            <tr>
              <td>{{ q[0] }}</td>
              <td>{{ q[1] }}</td>
              <td>{{ answer_counts.get(q[0], 0) }}</td>
              <td>
                <a href="/edit_question/{{ q[0] }}" class="btn btn-sm btn-warning">Edit</a>
                <form action="/delete_question/{{ q[0] }}" method="post" style="display:inline;" onsubmit="return confirm('Are you sure you want to delete this question?');">
                  <button type="submit" class="btn btn-sm btn-danger">Delete</button>
                </form>
              </td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
        <h4 class="mt-5">Audit Log</h4>
        <table class="table table-striped table-bordered">
          <thead class="table-light">
            <tr>
              <th>Time</th>
              <th>User ID</th>
              <th>Action</th>
              <th>Details</th>
            </tr>
          </thead>
          <tbody>
            {% for log in audit_logs %}
            <tr>
              <td>{{ log['timestamp'] }}</td>
              <td>{{ log['user_id'] }}</td>
              <td>{{ log['action'] }}</td>
              <td>{{ log['details'] }}</td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
        <!-- Add this inside your admin dashboard page -->
<form method="POST" action="{{ url_for('add_question') }}" class="mb-4">
    <div class="mb-3">
        <label for="question_text" class="form-label">Add Exam Question</label>
        <textarea class="form-control" id="question_text" name="question_text" rows="2" required></textarea>
    </div>
    <button type="submit" class="btn btn-primary">Add Question</button>
</form>
    </div>
    {% endblock %}

    <!-- Add Bootstrap JS and dependencies -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.0/umd/popper.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
</body>
</html>
